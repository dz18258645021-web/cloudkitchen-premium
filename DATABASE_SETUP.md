# 云数据库配置指南

本项目已升级为使用 Supabase 云数据库的实际应用。以下是完整的配置步骤：

## 1. 创建 Supabase 项目

1. 访问 [Supabase](https://supabase.com) 并注册账号
2. 创建新项目
3. 等待项目初始化完成

## 2. 配置数据库

1. 在 Supabase 项目面板中，点击左侧的 "SQL Editor"
2. 复制 `scripts/init-database.sql` 文件的全部内容
3. 粘贴到 SQL 编辑器中并运行
4. 确认所有表和函数都创建成功

## 3. 获取项目配置

1. 在项目面板中，点击左侧的 "Settings" → "API"
2. 复制以下信息：
   - Project URL
   - anon public key

## 4. 更新环境变量

编辑 `.env.local` 文件，更新以下配置：

```env
# Supabase 配置
VITE_SUPABASE_URL=你的项目URL
VITE_SUPABASE_ANON_KEY=你的匿名密钥
```

## 5. 测试连接

1. 启动应用：`npm run dev`
2. 以员工身份登录（密码：1234）
3. 在菜单管理页面点击"数据库"按钮
4. 点击"测试连接"验证配置
5. 点击"初始化数据库"导入示例数据

## 功能特性

### 实时数据同步
- 订单状态实时更新
- 多用户同时操作时数据自动同步

### 数据持久化
- 菜品信息永久保存
- 订单历史完整记录
- 用户数据和统计信息

### 性能优化
- 数据库索引优化查询速度
- 批量操作减少网络请求
- 错误处理和重试机制

## 数据库结构

### 主要表格
- `users` - 用户信息
- `dishes` - 菜品信息
- `orders` - 订单数据
- `reservations` - 预约信息

### 关键功能
- 自动更新时间戳
- 菜品销量统计
- 用户消费统计
- 行级安全策略

## 故障排除

### 连接失败
1. 检查网络连接
2. 验证 Supabase URL 和密钥
3. 确认项目状态正常

### 数据不同步
1. 检查浏览器控制台错误
2. 验证数据库权限设置
3. 重新初始化数据库

### 性能问题
1. 检查数据库索引
2. 优化查询语句
3. 考虑数据分页

## 本地开发

如需本地开发环境，可以使用 Supabase CLI：

```bash
# 安装 Supabase CLI
npm install -g supabase

# 初始化本地项目
supabase init

# 启动本地服务
supabase start

# 更新环境变量为本地地址
VITE_SUPABASE_URL=http://localhost:54321
VITE_SUPABASE_ANON_KEY=本地匿名密钥
```

## 生产部署

1. 确保生产环境变量正确配置
2. 启用 Supabase 项目的生产模式
3. 配置适当的安全策略
4. 设置数据备份计划

## 扩展功能

### 可添加的功能
- 用户认证和权限管理
- 图片上传到云存储
- 支付集成
- 数据分析和报表
- 移动端推送通知

### 数据库优化
- 添加更多索引
- 实现数据分区
- 设置读写分离
- 配置缓存策略